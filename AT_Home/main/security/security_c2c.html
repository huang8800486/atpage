<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>交易系统</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="keyword" content="比特币价格,比特币交易平台,区块链,数字化资产,比特币行情,AT交易所,USDT,莱特币,BCH,以太坊,ETH,以太经典,进行币币交易" />
    <meta name="description" content="description:AT交易所是一家集数字化资产、投资服务、资讯服务于一体的国际化区块链资产交易平台。提供比特币,莱特币(LTC),以太坊(ETH),比特币现金(BCH),以太经典(ETC)达世币(DASH)等虚拟货币以比特币(BTC)、USDT进行交易！提供实时比特币价格,比特币行情。">
    <link rel="stylesheet" href="../../assets/css/reset.css">
    <link rel="stylesheet" href="../../assets/font/iconfont.css">
    <link rel="stylesheet" href="../../assets/css/layout.css">
    <script src="../../script/jquery-3.3.1.min.js"></script>
    <script src="../../script/tools/crypto-js.js"></script>
    <script src="../../script/tools/jquery.cookie.js"></script>
    <script src="../../script/tools/md5.min.js"></script>
    <script src="../../script/tools/k_tools.js"></script>
    <script src="../../script/tools/loadSiteInfo.js"></script>
    <script src="../../script/tools/jquery-ui.js"></script>
    <script src="../../script/trade/tools.js"></script>
    <script src="../../script/center_toos/center_tools_new.js"></script>
    <script src="../../script/template.js"></script>
    <script src="../../script/layer.js"></script>
    <script src="../../script/IdCodeValid.js"></script>
    <script src="../../assets/js/translate/jquery.i18n.properties/jquery.i18n.properties.min.js" charset="utf-8"></script>
    <script src="../../assets/js/translate/i18n.config.js" charset="utf-8"></script>
    <script src="../../pluguns/jquery-city-select/dist/jquery.city.select.min.js"></script>
    <script src="../../pluguns/jquery-city-select/demo/assets/js/prettify.js"></script>
    <script src="../../pluguns/jquery-city-select/demo/assets/js/data.js"></script>
</head>
<body>
<!-- header -->
<div class="view_body security_center_view_body cardinfo_view_body bankmanage_view_body security_c2c_view_body">
    <header class="header header-other" id="header"></header>
    <div class="negative_content_page">
        <div class="dynamic-width negative_content">
            <div class="main-safety leftbar_padding clearfix">
                <div class="safety-leftbar" id="left"></div>
                <div class="safety-right">
                    <div class="safety-top-title">
                        <div class="safety-top-user">
                            <h1><i class="iconfont icon-morentouxiang"></i></h1>
                            <dl>
                                <dt id="trueName"></dt>
                            </dl>
                        </div>
                    </div>
                    <div class="safety-list safety-list-c2c safety-cardinfo-card safety-list-c2c_wrap">
                        <div class="step-wrapper">
                            <div class="forget-step">
                                <div class="step-tu safety-step-tu">
                                    <div class="steps1 safety-idCard-step"></div>
                                    <div class="steps2 safety-tradePwd-step"></div>
                                    <div class="steps3 safety-payCard-step"></div>
                                </div>
                                <div class="step-text safety-step-text">
                                    <ul>
                                        <li id="text1" translate="security_first2">实名认证</li>
                                        <li id="text2" translate="zhezhijiaoyimima">设置交易密码</li>
                                        <li id="text3" translate="bangdingyinhangka">绑定银行卡</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="safety-form safety-idCard safety-idCard-c2c" style="display:none;">
                            <div class="safety-cardinfo safety-cardinfo-card">
                                <!-- <h2 class="safety-cardinfo-card-h2" translate="security_first22">您的身份证信息</h2> -->
                                <ul>
                                    <li style="display: none" id="cardInfo-CardInfo" class="card_info_detail">
                                        <div class="safety-form" id="noCardInfo">
                                            <div class="cardtype">
                                                <p><em class="translate_em" translate="security_first26"></em><strong class="newcolor"><em class="translate_em" translate="security_first27"></em></strong></p>
                                            </div>
                                            <div class="inputcard_wrap">
                                                <div class="inputcard">
                                                    <div class="input_wrap">
                                                        <span translate="security_first28">真实姓名</span>
                                                        <input id="trueNames" type="text" class="frominput" value="" placeholder=""  autocomplete="new-password">
                                                    </div>
                                                </div>
                                                <div class="inputcard idcard_inputcard">
                                                    <div class="input_wrap">
                                                        <span translate="security_first29">身份证号</span>
                                                        <input id="idcard" type="text" class="frominput" value="" placeholder="" maxlength="18" autocomplete="new-password" onkeyup="checkIdCard(this.value, event)">
                                                        <strong class="tips red"></strong>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                        </div>
                                        
                                        <div id="cardzs">
                                            <!-- <div class="cardrzName_img">
                                                <img src="../../images/icon-card-person.png">
                                            </div>
                                            <div class="cardrzName_wrap">
                                                <h2 class="c_blue2" id="cardrzName"></h2>
                                                <span class="deep-gray" id="div_showInfo" translate="security_first39">请上传手持身份证照片，身份证正面照， 身份证背面照</span>
                                            </div>  -->
                                            <div class="upload_tips">
                                                <h2 translate="qingshangchuanziliao">请上传资料</h2>
                                                <p translate="security_first42">图片大小&#60;10M，支持.jpg .png .bmp格式</p>
                                            </div>
                                        </div>
                                        <div class="safety-cardup" id="uploadcard">
                                            <div class="uploadcard_wrap">
                                                <ul>
                                                    <li class="clearfix">
                                                        <span class="cardup-name" translate="security_first40">身份证正面照</span>
                                                        <div class="cardup-pic-wrap">
                                                            <span class="cardup-pic">
                                                                <img width="220" height="150" src="" id="file_card_1_img" style="display: none">
                                                            </span>
                                                            <a href="javascript:;" class="update_target update_target_1">
                                                                <div class="file_deta">
                                                                    <i class="iconfont icon-tianjia"></i>
                                                                    <p translate="dianjitianjiatupian">点击添加图片</p>
                                                                </div>
                                                                <input type="file" id="file_card_1" multiple onchange='Upfile("file_card_1")'>
                                                            </a>
                                                        </div>
                                                        
                                                        <div class="cardup-exmaple">
                                                            <img src="../../images/card_front.jpg" alt="">
                                                        </div>
                                                    </li>
                                                    <li class="clearfix">
                                                        <span class="cardup-name" translate="security_first43">身份证反面照</span>
                                                        <div class="cardup-pic-wrap">
                                                            <span class="cardup-pic">
                                                                <img width="220" height="150" src="" id="file_card_2_img" style="display: none">
                                                            </span>
                                                            <a href="javascript:;" class="update_target update_target_1">
                                                                <div class="file_deta">
                                                                    <i class="iconfont icon-tianjia"></i>
                                                                    <p translate="dianjitianjiatupian">点击添加图片</p>
                                                                </div>
                                                                <input type="file" id="file_card_2" multiple onchange='Upfile("file_card_2")'>
                                                            </a>
                                                        </div>
                                                        <div class="cardup-exmaple">
                                                            <img src="../../images/card_back.jpg" alt="">
                                                        </div>
                                                    </li>
                                                    <li class="clearfix">
                                                        <span class="cardup-name" translate="security_first44">手持身份证照</span>
                                                        <div class="cardup-pic-wrap">
                                                            <span class="cardup-pic">
                                                                 <img width="220" height="150" src="" id="file_card_3_img" style="display: none">
                                                            </span>
                                                            <a href="javascript:;" class="update_target update_target_1">
                                                                <div class="file_deta">
                                                                    <i class="iconfont icon-tianjia"></i>
                                                                    <p translate="dianjitianjiatupian">点击添加图片</p>
                                                                </div>
                                                                <input type="file" id="file_card_3" multiple onchange='Upfile("file_card_3")'>
                                                            </a>
                                                        </div>

                                                        <div class="cardup-exmaple">
                                                            <img src="../../images/card_hand.jpg" alt="">
                                                            <!-- <em translate="security_first45">右手持身份证件，左手持带有AT3.com、认证人签名、认证当天时间的证明文件。</em> -->
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="cardup-up clearfix">
                                                <a id="save" class="new-btn-color" onclick="save()" translate="financial_first4_button">提交</a>
                                                <input type="hidden" id="hid_file_card_1" />
                                                <input type="hidden" id="hid_file_card_2" />
                                                <input type="hidden" id="hid_file_card_3" />
                                            </div>
                                        </div>
                                        
                                        
                                        <div class="inputcard_text">
                                            <span translate="reminder1">温馨提示：</span>
                                            <p translate="security_first30">1、根据国家反洗钱法，所有在本站交易的用户均需要实名认证，</p>
                                            <p translate="security_first35">请提供真实有效的手持本人身份证照片，虚假认证可能会导致账户被冻结，</p>
                                            <p translate="security_first36">由虚假认证产生的一切后果由用户负责！</p>
                                            <p translate="security_first37">2、用户需要手动填写证件信息，请尽可能保证证件照清晰、</p>
                                            <p class="red" translate="security_first38">3、照片要求：右手持身份证件，左手持带有AT3.com、认证人签名、认证当天时间的证明文件。</p>
                                        </div>
                                    </li>
                                    <li style="display: none" id="cardInfo-audit" class="card_info_detail wait_cardinfo">
                                        <div class="info_detail">
                                            <div class="cardrzName_img">
                                                <img src="../../images/icon-card-audit.png">
                                            </div>
                                            <div class="info_detail_text">
                                                <span></span>
                                            </div>
                                            <div class="info_de">
                                                <!-- <span class="type-color"><em class="translate_em" translate="security_first25">您的身份证信息</em><em class="translate_em" translate="security_first26"></em></span> -->
                                                <span id="audit_truename" class="card_truename"></span>
                                                <span id="audit_idcard" class="idcard-number"></span>
                                            </div>
                                        </div>
                                    </li>
                                    <li style="display: none" id="cardInfo-unsucceed" class="card_info_detail wait_cardinfo">
                                        <div class="info_detail">
                                            <div class="cardrzName_img">
                                                <img id="img_cardez" src="../../images/icon-card-succeed.png">
                                            </div>
                                            <div class="info_detail_text">
                                                <span translate="shimingrenzhengweitongguo">实名认证未通过</span>
                                            </div>
                                            <div class="info_de">
                                                <!-- <span class="type-color"><em class="translate_em" translate="security_first25">您的身份证信息</em><em class="translate_em" translate="security_first26"></em></span> -->
                                                <em translate="weitongguoyuanyin">未通过原因：</em>
                                                <span id="unsucceed_text"></span>
                                                <a href="javascript:;" class="recard" onclick="reCard()" translate="chongxinrenzheng">重新认证</a>
                                            </div>
                                        </div>
                                    </li>
                                    <li style="display: none" id="cardInfo-succeed" class="card_info_detail wait_cardinfo">
                                        <div class="info_detail">
                                            <div class="cardrzName_img">
                                                <img id="img_cardez" src="../../images/icon-card-succeed.png">
                                            </div>
                                            <div class="info_detail_text">
                                                <span></span>
                                            </div>
                                            <div class="info_de">
                                                <!-- <span class="type-color"><em class="translate_em" translate="security_first25">您的身份证信息</em><em class="translate_em" translate="security_first26"></em></span> -->
                                                <span id="succeed_truename" class="card_truename"></span>
                                                <span id="succeed_idcard" class="idcard-number"></span>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="safety-cardup" id="uploadcard" style="display:none;">
                                <!-- <h1>请上传资料</h1> -->
                                <ul>
                                    <li class="clearfix">
                                        <span class="cardup-name" translate="security_first40"></span>
                                        <div class="cardup-pic-wrap">
                                            <span class="cardup-pic">
                                                <img width="220" height="150" src="" id="file_card_1_img" style="display: none">
                                            </span>
                                            <span class="cardup-btn">
                                                <div class="am-form-group am-form-file" style="cursor: pointer">
                                                    <button type="button" id="btn_upFile_1" translate="security_first41">上传照片</button>
                                                    <!-- <input type="file" id="file_card_1" multiple onchange='Upfile("file_card_1")'> -->
                                                    <strong class="file_text file_text_file_card_1" translate="security_first42">图片大小<10M</strong>
                                                </div>
                                            </span>
                                            <a href="javascript:;" class="update_target update_target_1">
                                                <input type="file" id="file_card_1" multiple onchange='Upfile("file_card_1")'>
                                            </a>
                                        </div>
                                        
                                        <span class="cardup-exmaple">
                                            <img src="../../images/card_front.jpg" alt="">
                                            <p class="file_text_format" translate="tupiangeshi"></p>
                                        </span>
                                    </li>
                                    <li class="clearfix">
                                        <span class="cardup-name" translate="security_first43">身份证反面照</span>
                                        <div class="cardup-pic-wrap">
                                            <span class="cardup-pic">
                                                <img width="220" height="150" src="" id="file_card_2_img" style="display: none">
                                            </span>
                                            <span class="cardup-btn">
                                                <div class="am-form-group am-form-file" style="cursor: pointer">
                                                    <button type="button" id="btn_upFile_2" translate="security_first41">上传照片</button>
                                                    <!-- <input type="file" id="file_card_2" multiple onchange='Upfile("file_card_2")'> -->
                                                    <strong class="file_text file_text_file_card_2" translate="security_first42">图片大小<10M</strong>
                                                </div>
                                            </span>
                                            <a href="javascript:;" class="update_target update_target_1">
                                                <input type="file" id="file_card_2" multiple onchange='Upfile("file_card_2")'>
                                            </a>
                                        </div>
                                        <span class="cardup-exmaple">
                                            <img src="../../images/card_back.jpg" alt="">
                                            <p class="file_text_format" translate="tupiangeshi"></p>
                                        </span>
                                    </li>
                                    <li class="clearfix">
                                        <span class="cardup-name" translate="security_first44">手持身份证照</span>
                                        <div class="cardup-pic-wrap">
                                            <span class="cardup-pic">
                                                 <img width="220" height="150" src="" id="file_card_3_img" style="display: none">
                                            </span>
                                            <span class="cardup-btn">
                                                <div class="am-form-group am-form-file" style="cursor: pointer">
                                                    <button type="button" id="btn_upFile_3"translate="security_first41">上传照片</button>
                                                    <!-- <input type="file" id="file_card_3" multiple onchange='Upfile("file_card_3")'> -->
                                                    <strong class="file_text file_text_file_card_3" translate="security_first42">图片大小<10M</strong>
                                                </div>
                                            </span>
                                            <a href="javascript:;" class="update_target update_target_1">
                                                <input type="file" id="file_card_3" multiple onchange='Upfile("file_card_3")'>
                                            </a>
                                        </div>

                                        <span class="cardup-exmaple">
                                            <img src="../../images/card_hand.jpg" alt="">
                                            <em translate="security_first45">右手持身份证件，左手持带有AT3.com、认证人签名、认证当天时间的证明文件。</em>
                                        </span>
                                    </li>
                                    <li class="cardup-up clearfix">
                                        <span>
                                            <button id="save" type="button" class="am-btn am-btn-secondary am-radius am-btn-block" onclick="save()" translate="financial_first4_button">提交</button>
                                            <input type="hidden" id="hid_file_card_1" />
                                            <input type="hidden" id="hid_file_card_2" />
                                            <input type="hidden" id="hid_file_card_3" />
                                        </span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="safety-form safety-tradePwd safety-tradePwd-c2c" style="display:none;">
                            <div class="c2c-forg">
                                <div class="am-form-group" id="oldPwdInput" style="display: none">
                                    <span class="titl" translate="security_first46">交易密码</span>
                                    <div class="input_wrap">
                                        <input id="tb_oldpwd" type="password" class="frominput" value="" placeholder="" maxlength="60" minlength="6" autocomplete="new-password">
                                    </div>
                                </div>
                                <div class="am-form-group">
                                    <span class="titl" translate="security_first47">新交易密码</span>
                                    <div class="input_wrap">
                                        <input id="newpaypassword" type="password" class="frominput" value="" placeholder="" maxlength="60" minlength="6" autocomplete="new-password" onkeyup="chckeStrength(this, this.value)">
                                        <strong class="pwd_tips"></strong>
                                        <p class="pwdstrength" translate="6_20">6～20位，必须包含大小写字母和数字</p>
                                    </div>
                                </div>
                                <div class="am-form-group">
                                    <span class="titl" translate="security_first48">确认密码</span>
                                    <div class="input_wrap">
                                        <input id="repaypassword" type="password" class="frominput" value="" placeholder="" maxlength="60" minlength="6" autocomplete="new-password">
                                        <p class="pwdstrength" translate="6_20">6～20位，必须包含大小写字母和数字</p>
                                    </div>
                                </div>
                                <a type="button" class="new-btn-color" id="editPwdButton" onclick="editPwd()" translate="security_button">确认修改</a>
                                <div class="forger-pwd-wrap">
                                    <a href="../forgetTradePwd.html" class="forger-pwd" translate="forget_Login_Pwd">忘记交易密码?</a>
                                </div>
                                <div class="note">
                                    <strong translate="security_info1">温馨提示：</strong>
                                    <p>
                                        <!--<span class="red">如果没有设置过交易密码请留空</span><br>-->
                                        <em class="translate_em" translate="security_info41"></em><br>
                                        <em class="translate_em" translate="security_info42"></em> <br>
                                        <em class="translate_em" translate="security_info43"></em>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="safety-form safety-payCard safety-payCard-c2c" id="card-form" style="display:none;">
                            <div class="modify_personal_info">
                                <div class="bankmanage-detail">
                                    <!--添加银行卡-->
                                    <div class="bankmanage-card-form" id="card-form">
                                        <div class="bankmanage-card-content">
                                            <h2 class="bank_h2"><span translate="security_first51">添加银行卡</span><em translate="zhinengshiyongbenrenyinhangkashoukuan">只能使用本人银行卡收款</em></h2>
                                            <div class="bank-top">
                                                <div class="am-form-group">
                                                    <span class="titl" translate="security_first52">备注名称</span>
                                                    <div class="input_wrap">
                                                        <input id="tb_Memo" type="text" class="frominput" value="" placeholder="" maxlength="30" autocomplete="new-password">
                                                    </div>
                                                </div>
                                                <div class="am-form-group clearfix">
                                                    <div class="am-form-group-select">
                                                        <span class="titl" translate="security_first53">开户银行</span>
                                                        <div class="input_wrap">
                                                            <i class="iconfont icon-arrows-down"></i>
                                                            <select id="ddl_BankList" class="am-form-select am-btn-block am-radius">
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="am-form-group-select">
                                                        <span class="titl" translate="security_first541">开户省份</span>
                                                        <div class="input_wrap">
                                                            <!--<input id="tb_bankprov" type="text" class="frominput" value="" placeholder="请输入省份" maxlength="30">-->
                                                            <i class="iconfont icon-arrows-down"></i>
                                                            <select id="tb_bankprov" class="am-form-select am-btn-block am-radius">
                                                                <option value="载入中" translate="zairuzhong">载入中</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="am-form-group-select">
                                                        <span class="titl" translate="security_first542">开户城市</span>
                                                        <div class="input_wrap">
                                                            <!--<input id="tb_bankcity" type="text" class="frominput" value="" placeholder="请输入城市" maxlength="30">-->
                                                            <i class="iconfont icon-arrows-down"></i>
                                                            <select id="tb_bankcity" class="am-form-select am-btn-block am-radius">
                                                                <option value="zairuzhong">载入中</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="am-form-group">
                                                    <span class="titl" translate="security_first543">开户支行</span>
                                                    <div class="input_wrap">
                                                        <input id="tb_bankaddr" type="text" class="frominput" value="" placeholder="" maxlength="30" autocomplete="new-password">
                                                    </div>
                                                </div>
                                                <div class="am-form-group">
                                                    <span class="titl form-txt-title" translate="security_first54">开户姓名</span>
                                                    <div class="input_wrap">
                                                        <!-- <span class="form-txt-cont" id="truename"></span> -->
                                                        <input id="khtruename" type="text" class="frominput" value="" placeholder="" maxlength="30" autocomplete="new-password" disabled>
                                                    </div>
                                                    
                                                </div>
                                                <div class="am-form-group">
                                                    <span class="titl" translate="security_first55">银行卡号</span>
                                                    <div class="input_wrap">
                                                        <input id="tb_bankcard" type="text" class="frominput" value="" autocomplete="new-password" placeholder="" maxlength="30"
                                                               onKeyUp="value=value.replace(/[^\d]/g,'')"
                                                               onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))"/>
                                                    </div>
                                                </div>
                                                <div class="am-form-group">
                                                    <span class="titl" translate="middle1_market1_placeholder6">交易密码</span>
                                                    <div class="input_wrap">
                                                        <input id="tb_payPwd" type="password" class="frominput" value="" placeholder="" maxlength="30" autocomplete="new-password">
                                                    </div>
                                                </div>
                                                <a type="button" class="new-btn-color" onclick="AddBank()" translate="lijitianji">立即添加 </a>
                                                <input type="hidden" id="hid_truename" />
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        
                        
                        <div class="cl"></div>
                    </div>
                    <div class="reg-info-tip am-text-center reg-info-cardinfo" style="display:none;">
                        <p><img src="../../images/icon-yes.png"></p>
                        <h1 translate="ziliaoyitijiao">资料已提交，我们将尽快为您审核!</h1>
                    </div>

                    <div class="reg-info-tip am-text-center reg-info-other" style="display:none;">
                        <p><img src="../../images/icon-yes.png"></p>
                        <h1 translate="gongxinishezhichenggong">恭喜你设置成功!</h1>
                        <p class="deep-gray"><em class="translate_em" id="wait"></em><span class="newcolor" translate="miaozhonghoujiangzidongtiaozhuan"></span> </p>
                        <p><a href="../c2c/qd.html" class="am-btn gotoqd new-btn-color am-radius am-btn-lg" translate="quC2Cjiaoyi">去c2c交易</a></p>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <footer class="footer" id="footer"></footer>
</div>
<!--[if lt IE 9]>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="../../assets/js/amazeui.ie8polyfill.min.js"></script>
<![endif]-->
<script src="../../assets/js/amazeui.min.js"></script>
<script src="../../assets/js/count-number.js"></script>

<script type="text/javascript">
    $(function () {
        $("#header").load("../common/commonHeader.html?version=" + $.version);
        $("#footer").load("../common/commonFooter.html?version=" + $.version);
        $("#left").load("./left.html");

        init();
    });

    function init() {
        var cookieStr = $.getToken();

        //  如果已经登录，则取得财务中心数据
        if (!$.TokenIsNull(cookieStr)) {
            //  获取用户信息
            Getassets();
            getUserInfo();
            getBakeList();
            getMyBankList();
        }else {
            $.toIndex1();
        }
    }
</script>

<!--功能函数-->
<script type="text/javascript">
    /**
     * 获取用户信息
     * @constructor
     */
    var isSetTradePwd = null;       // 交易密码
    function getUserInfo() {
        $.ajaxSendData("", "/api/user/details", function(resData){
            isSetTradePwd = resData.data.status;
        });
    }
    // var userInfo = $.sendData("", "/api/user/details");
    // var isSetBank = $.sendData("", "/api/user/bank/card/list");
    $.ajaxSendData("", "/api/user/details", function(userInfo){
        $.ajaxSendData("", "/api/user/bank/card/list", function(isSetBank){
            if(isSetBank.data.length > 0 && userInfo.data.status == 1 && userInfo.data.cardrz == 1){
                window.location.href = "security_center.html"
            }
            // 三.是否有银行卡
            if (isSetBank.data.length > 0) {
                $(".safety-payCard-step").addClass("on");
            }else {
                $(".safety-form").hide();
                if(userInfo.data.status !== 3){
                    $(".safety-payCard").show();
                }else{
                    $(".safety-payCard").hide();
                }
            }

            // 二.是否设置交易密码
            if (userInfo.data.status == 3 ){
                $(".safety-tradePwd").show();
                // 1.跳到使命认证
                // nextIDCard();
                $(".forger-pwd").hide();
            }else{
                $(".forger-pwd").show();
                $(".safety-tradePwd-step").addClass("on");
                $(".safety-tradePwd").hide();
            }

            // 一.是否身份认证
            if(userInfo.code == 200){
                // 是否设置过身份
                if (userInfo.data.cardrz == 0 || userInfo.data.cardrz == 3 || userInfo.data.cardrz == 4) {
                    $(".safety-form").hide();
                    $(".safety-idCard").show();
                }
                else if (userInfo.data.cardrz == 2) {   // 审核
                    $(".safety-form").hide();
                    $(".safety-idCard-step").addClass("on");
                    
                } else {            // 已认证
                    $(".safety-idCard-step").addClass("on");
                    $(".safety-idCard").hide();
                }
            }

            // 实名认证
            if (userInfo.data.cardrz == 0 || userInfo.data.cardrz == 3 || userInfo.data.cardrz == 4) {
                $("#text3").removeClass("on");
                $("#cardInfo-CardInfo").show();
                $("#uploadcard").show();
                $("#noCardInfo").show();
                
            }
            else if (userInfo.data.cardrz == 2) {
                $(".reg-info-cardinfo").show();
                $(".safety-idCard-step").addClass("on");
            } else {
                // $("#cardrzName").html("已通过实名认证");
                // $("#div_showInfo").hide();
                // $("#img_cardez").attr("src", "../../images/icon-yes.png");
                // $("#cardInfo").show();
            }
        });
    });

    // 三.跳到银行卡
    function nextBankCard(){
        $(".safety-tradePwd-step").addClass("on");
        $(".safety-form").hide();
        $(".safety-payCard").show();
    }
    

    // 四.完成认证
    function endSecurity(){
        $(".safety-payCard-step").addClass("on");
        $(".safety-form").hide();
        $(".reg-info-other").show();
        /**
         *  跳转到登录页面
         */
        toLoginPage();
        
    }

    function toLoginPage() {
        var obj = $('#wait');
        var wait = 3;
        var interval = setInterval(function () {
            obj.html(wait);
            wait--;
            if (wait < 0) {
                clearInterval(interval);
                window.location.href = "../c2c/qd.html"
            }
        }, 1000);
    }

    function chckeStrength(obj, objvalue){
        if($.passwordStrength(objvalue)){
            $(obj).parents(".am-form-group").find(".pwd_tips").html("")
            $(obj).removeClass("v_error_new")
        }else{
            $(obj).addClass("v_error_new")
            $(obj).parents(".am-form-group").find(".pwd_tips").html(langPkg.getI18N("mimaqiangdutaidi"))
        }
    }
    /*$("#trueNames").on("keypress", function(){
        var namelen = $(this).val();
        if($(this).val().length > 5){
            $(this).val(namelen.substring(0, 4));
        }
    })*/

    // 设置交易密码
        
    function editPwd() {
        $.ajaxSendData("", "/api/user/details", function(resData){
            isSetTradePwd = resData.data.status;
            //  如果等于3，则是没有设置过交易密码，那么，交易密码可以留空
            if ( isSetTradePwd == 3 ){
                $("#btn_submit").attr("disabled", "");

                var newpassword = $("#newpaypassword").val().trim();
                var repassword = $("#repaypassword").val().trim();

                if(newpassword==""){
                    layer.tips(langPkg.getI18N("security_first4_placeholder2"), '#newpaypassword', { tips: [3, "#0e9e80"], time: 2000, end: function () { $("#btn_submit").removeAttr("disabled"); } });
                    return false;
                }
                if(repassword==""){
                    layer.tips(langPkg.getI18N("qingzaicishuruxinmima"), '#repaypassword', { tips: [3, "#0e9e80"], time: 2000, end: function () { $("#btn_submit").removeAttr("disabled"); } });
                    return false;
                }

                if(newpassword != repassword){
                    layer.tips(langPkg.getI18N("liangcishurudemimabuyizhi"), '#repaypassword', { tips: [3, "#0e9e80"], time: 2000, end: function () { $("#btn_submit").removeAttr("disabled"); $("#repaypassword").val(""); } });
                    return false;
                }

                if (!$.passwordStrength(newpassword)) {
                    layer.tips(langPkg.getI18N("mimaqiangdutaidi"), "#newpaypassword", {
                        tips: [3, "#0e9e80"], time: 2000, end: function () {
                            $("#editPwdButton").removeAttr("disabled");
                        }
                    });
                    return false;
                }

                //  整合数据
                var param = {
                    paypwd: newpassword,
                };



                $.ajaxSendData(param, "/api/user/set/paypwd", function(resData){

                });
                if (resData.code == 200) {
                    layer.msg(langPkg.getI18N("xiugaiwancheng"), { icon: 1, time: 2000 }, function () {
                        $("#btn_submit").removeAttr("disabled");
                        $("#newpaypassword").val("");
                        $("#repaypassword").val("");
                        nextBankCard();
                    });
                }else {
                    layer.msg(resData.msg, { icon: 2, time: 2000 }, function () {
                        $("#btn_submit").removeAttr("disabled");
                    });
                }
            }
            //  否则，则需要验证交易密码
            else {
                
            }
        });
    }


    

    

    /*
    * 设置银行卡
    */
    $(function () {
        $("#tb_bankprov,#tb_bankcity").citylist({
            data    : data,
            id      : 'id',
            children: 'cities',
            name    : 'name',
            metaTag : 'name'
        })
    });
    function Getassets() {
        $.ajaxSendData("", "/api/user/details", function(resData){
            $("#userName").html(resData.data.username);
            $("#khtruename").val(resData.data.truename);
            $("#truename").html(resData.data.truename);
            $("#hid_truename").val(resData.data.truename);

            status = resData.data.status;

            // if ( status == 3 ){
            //     var index = layer.load(2, {
            //         time: 10*1000,
            //         shade: [0.75,'#000'] //0.1透明度的白色背景
            //     });
            //     layer.msg("您尚未设置交易密码，请先设置交易密码在进行银行卡管理操作！", { time: 1000, icon: 6 }, function () {
            //         layer.close(index);
            //         window.location.href = "./update_trade_pwd.html";
            //     })
            // }
        });
    }

    function getBakeList() {
        $.ajaxSendData("", "/api/user/bank/bankType/list", function(resData){
            if (resData.data.length > 0) {
                var da = { "list": resData.data };
                var _html = template('bank_list', da);
                $("#ddl_BankList").html(_html);
            }
        });
    }

    function AddBank() {
        var bankName = $('#ddl_BankList option:selected').text();;
        var bankaddr = $("#tb_bankaddr").val();
        var bankcard = $("#tb_bankcard").val();

        var bankcity = $("#tb_bankcity option:selected").val();
        var bankprov = $("#tb_bankprov option:selected").val();

        var Memo = $("#tb_Memo").val();
        var payPwd = $("#tb_payPwd ").val();

        if (Memo == "") {
            layer.tips('请填写备注名称', '#tb_Memo', { tips: [3, "#0e9e80"], time: 2000, end: function () {} });
            return;
        }
        if (bankName == "") {
            layer.tips('请选择银行', '#ddl_BankList', { tips: [3, "#0e9e80"], time: 2000, end: function () {} });
            return;
        }
        if (bankprov == "") {
            layer.tips('请输入开户行省', '#tb_bankprov', { tips: [3, "#0e9e80"], time: 2000, end: function () {} });
            return;
        }
        if (bankcity == "") {
            layer.tips('请输入开户行市', '#tb_bankcity', { tips: [3, "#0e9e80"], time: 2000, end: function () {} });
            return;
        }
        if (bankcard == "") {
            layer.tips('请输入银行卡号', '#tb_bankcard', { tips: [3, "#0e9e80"], time: 2000, end: function () {} });
            return;
        }

        var isBankCard = $.luhmCheck(bankcard);

        if ( !isBankCard ){
            layer.msg("银行卡格式不正确，请重新输入！", { icon: 2, time: 2000 });
            return;
        }
        
        if (payPwd == "") {
            layer.msg('请输入交易密码', { icon: 2, time: 2000 });
            return;
        }


        var param = {
            bank: bankName,
            bankaddr: bankaddr,
            bankcard: bankcard,
            bankcity: bankcity,
            bankprov: bankprov,
            name: Memo,
            payPwd: payPwd
        };

        $.ajaxSendData(param, "/api/user/bank/card/save", function(){
            $("#a_close_addBank").click();
            /*layer.msg('操作成功');*/

            $('#ddl_BankList option:selected').val("-1");;
            $("#tb_bankaddr").val("");
            $("#tb_bankcard").val("");
            $("#tb_bankcity").val("");
            $("#tb_bankprov").val("");
            $("#tb_Memo").val("");
            $("#tb_payPwd ").val("");
            // getMyBankList();
            // window.location.href = "security_center.html";
            endSecurity();
        });
    }

    function getMyBankList() {
        $.ajaxSendData("", "/api/user/bank/card/list", function(resData){
            if (resData.data.length > 0) {

            }else {
                $("#MyBank_List").html("<td colspan='6' style='text-align:center'>暂无银行卡，请添加!</td>");
            }
        });
    }

    /*
    * 实名认证
    */
    // 该身份证号是否绑定
    function checkIdCard(value, e){
        var keycode = e.which;          //keycode就是按键的编码,e当前元素element,e.which是当前的编码  
        if(value == "" || keycode == 32){
            $("#idcard").parents(".am-form-group").removeClass("active")
            return;
        }else{
            var param = {
                card: value
            };

            $.ajaxSendData(param, "/api/user/card/checkId", function(resData){
                if ( resData.code == 200 && resData.data){      // 身份证没有重复
                    $("#idcard").parents(".am-form-group").removeClass("active")
                    $("#save").removeAttr("disabled");
                }else{
                    // 该身份证号已绑定
                    $("#idcard").parents(".am-form-group").addClass("active")
                    $(".idcard_inputcard .tips").html(resData.msg)
                    // layer.msg(resData.msg, { icon: 2, time: 2000 });
                    $("#save").attr("disabled", "disabled");
                }
            });
        }
        
    }

</script>

<script id="bank_list" type="text/html">
    <!--<option value="-1" selected="selected">选择银行</option>-->
    {{each list as value i}}
    <option value="{{value.id}}">{{value.title}}</option>
    {{/each}}
</script>
<script>
    function Upfile(filename) {
        var formData = new FormData();
        var img_file = document.getElementById(filename);
        var fileObj = img_file.files[0];
        if(!fileObj) return;
        layer.load();
        formData.append("file", fileObj);////这里设置的是表单key、value，formData.append("Post Key", file input)

        $.ajax({
            type: "POST",
            processData: false,//重要设置，默认为true。默认情况下，发送的数据将被转换为对象以配合默认内容类型"application/x-www-form-urlencoded"。如果要发送DOM树信息或者其他不希望转换的信息，请设置为false。,这里我们需要做文件上传，所以设置为false

            url: $.getGateway() + "/api/file/upload",
            data: formData,
            async: false,
            dataType: "json",

            contentType: false,//重要设置，这里设置成false，个人理解是不设置Requset数据类型
            beforeSend: function (xhr) {
                //在这里设置请求头，如果请求头没有特别的要求，可以删除此处代码
                var Authorization = $.getToken();
                xhr.setRequestHeader("Access-Control-Allow-Origin", "*");
                xhr.setRequestHeader("Accept", "*/*");
                xhr.setRequestHeader("Access-Control-Max-Age", "3600");
                if(Authorization != ""){
                    xhr.setRequestHeader("Authorization", "Bearer " + Authorization);
                }else{
                    xhr.setRequestHeader("Authorization", "Bearer" + Authorization);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                // data = XMLHttpRequest.responseJSON;
                layer.msg(langPkg.getI18N("shangchuanshibai"), { icon: 2, time: 2000 });
                $(".file_text_" + filename).html(langPkg.getI18N("shangchuanshibai")).addClass("error");
                $("#" + filename).parent().find(".file_deta").hide();
                layer.closeAll('loading');
            },
            success: function (resdata) {
                if (resdata.code == 200) {
                    $("#" + filename).parent().find(".file_deta").hide();
                    $("#" + filename + "_img").attr("src", $.imgFilePath() + resdata.data);
                    $("#" + filename + "_img").show();
                    $("#hid_" + filename).val(resdata.data);
                    $(".file_text_" + filename).html(langPkg.getI18N("shangchuanchenggong")).removeClass("error");;
                } else {
                    $("#" + filename + "_img").hide();
                    layer.msg(langPkg.getI18N("shangchuanshibai"), { icon: 2, time: 2000 });
                    $(".file_text_" + filename).html(langPkg.getI18N("shangchuanshibai")).addClass("error");
                }
                layer.closeAll('loading');
            }
        });
    }


    function save() {
        // realInfo();

        var idCards = $("#idcard").val();
        var fullName = $("#trueNames").val();
        if(fullName==""){
            layer.msg(langPkg.getI18N("security_frist28_placeholder1"), { icon: 2, time: 2000, end: function () { $("#save").removeAttr("disabled"); } });
            return false;
        }
        if(idCards==""){
            layer.msg(langPkg.getI18N("security_first29_placeholder1"), { icon: 2, time: 2000, end: function () { $("#save").removeAttr("disabled"); }  });
            return false;
        }

        var res = IdentityCodeValid(idCards);
        if ( res[0] == true ) {
            var param = {
                card: idCards,
                fullName: fullName
            };

            $.ajaxSendData(param, "/api/user/auth", function(resData){
                var str_cardBack = $("#hid_file_card_2").val();
                var str_cardFront = $("#hid_file_card_1").val();
                var str_cardHold = $("#hid_file_card_3").val();

                if ( str_cardFront == "" ){
                    layer.msg(langPkg.getI18N("shengfenzhengzhengmianmeishangchuan"), { icon: 2, time: 2000 });
                    return;
                }

                if ( str_cardBack == "" ){
                    layer.msg(langPkg.getI18N("shengfenzhengfanmianmeishangchuan"), { icon: 2, time: 2000 });
                    return;
                }

                if ( str_cardHold == "" ){
                    layer.msg(langPkg.getI18N("shouchishenfenzhengtupianshangweishangchuan"), { icon: 2, time: 2000 });
                    return;
                }
                var param = { cardBack: str_cardBack, cardFront: str_cardFront, cardHold: str_cardHold };
                $.ajaxSendData(param, "/api/user/card/auth", function(resData){
                    layer.msg(resData.msg, { icon: 1, time: 2000 });
                    window.location.href = "cardinfo.html";
                });
            });
        }else {
            layer.msg(res[1], { icon: 2, time: 2000 });
        }
    }


    //判断token值是否为空
    if (!$.TokenIsNull($.getToken())) {

        //获取用户信息
        $.ajaxSendData("", "/api/user/details", function(resData){
            if (resData.data.cardrz == 2) {
                $("#file_card_1_img").attr("src", $.imgFilePath() + resData.data.idcardImg1);
                $("#file_card_2_img").attr("src", $.imgFilePath() + resData.data.idcardImg2);
                $("#file_card_3_img").attr("src", $.imgFilePath() + resData.data.idcardImg3);
                $("#file_card_1_img").show();
                $("#file_card_2_img").show();
                $("#file_card_3_img").show();
                $("#btn_upFile_1").html(langPkg.getI18N("chongxinshangchuan"));
                $("#btn_upFile_2").html(langPkg.getI18N("chongxinshangchuan"));
                $("#btn_upFile_3").html(langPkg.getI18N("chongxinshangchuan"));
            }
        });
    }
</script>
</body>
</html>
