<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>交易系统</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keyword" content="比特币价格,比特币交易平台,区块链,数字化资产,比特币行情,AT交易所,USDT,莱特币,BCH,以太坊,ETH,以太经典,进行币币交易" />
    <meta name="description" content="description:AT交易所是一家集数字化资产、投资服务、资讯服务于一体的国际化区块链资产交易平台。提供比特币,莱特币(LTC),以太坊(ETH),比特币现金(BCH),以太经典(ETC)达世币(DASH)等虚拟货币以比特币(BTC)、USDT进行交易！提供实时比特币价格,比特币行情。">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="./assets/css/reset.css">
    <link rel="stylesheet" href="./assets/font/iconfont.css">
    <link rel="stylesheet" href="./assets/css/layout.css?v=56565">
    <script src="./script/jquery-3.3.1.min.js"></script>
    <script src="./script/tools/crypto-js.js"></script>
    <script src="./script/tools/jquery.cookie.js"></script>
    <script src="./script/tools/md5.min.js"></script>
    <script src="./script/tools/k_tools.js"></script>
    <script src="./script/tools/loadSiteInfo.js"></script>
    <script src="./script/template.js"></script>
    <script src="./script/layer.js"></script>
    <script type="text/javascript" charset="utf-8" src="//g.alicdn.com/sd/ncpc/nc.js?t=2015052012"></script>
    <script type="text/javascript" charset="utf-8" src="//g.alicdn.com/sd/nch5/index.js?t=2015052012"></script>
    <script src="./script/common/common.js"></script>
    <script src="./assets/js/translate/jquery.i18n.properties/jquery.i18n.properties.min.js" charset="utf-8"></script>
    <script src="./assets/js/translate/i18n.config.js" charset="utf-8"></script>
</head>
<body class="body_login_register">
<div class="view_body login_view_body login_and_register">
    <!-- header -->
    <header id="header" class="header header-other"></header>
    <div class="negative_content_page">
        <div class="grid-container">
            <div class="negative_content">
                <div class="main-login clearfix">
                    <div class="login-list col-xs-12 col-sm-6 col-md-7 col-lg-8">
                        <div class="imagesbanner xs-hide md-show">

                        </div>
                        <!-- <span class="rightline"></span>
                        <div class="reg-right-info">
                            <p translate="login_message1">还不是AT的用户？<br><em class="login_message2"></em></p>
                            <p><a href="register.html" translate="register_button">马上注册</a></p>
                        </div> -->
                    </div>
                    <div class="login-right col-xs-12 col-sm-6 col-md-5 col-lg-4">
                        <div class="groupsetp">
                            <div class="login-group-setp login-group-setp-username">
                                <div class="webcome-at">
                                    <span class="titl" translate="welcome_at">欢迎登录AT账号</span>
                                </div>
                                <div class="login-group-wrap clearfix">
                                    <span class="titl" translate="username">账号</span>
                                    <div class="input_wrap">
                                        <input id="username" type="text" class="am-form-field am-radius" data-i18n-placeholder="username_placeholder"
                                               value="" onblur="checkPhone(this.value)" autocomplete="off">
                                    </div>
                                    <span class="at_msg pwd_tips" id="username_test"
                                          translate="username_right">请输入正确帐号</span>
                                </div>

                                <div class="login-group-wrap clearfix">
                                    <span class="titl" translate="password">密码</span>
                                    <div class="input_wrap">
                                        <input id="password" type="text" class="am-form-field am-radius" data-i18n-placeholder="password_placeholder"
                                               autocomplete="new-password" value="" onblur="checkPassword(this.value)"
                                               onkeyup="checkPassword(this.value)" onfocus="this.type='password'">
                                    </div>
                                    <span class="at_msg pwd_tips" id="password_test"
                                          translate="password_placeholder"></span>
                                </div>
                                <div class="login-group-wrap clearfix" style="margin: 0">
                                    <a class="forgetpwd" href="forgetLoginPwd.html" translate="forgetLoginPwd">忘记密码?</a>
                                </div>
                                <div class="login-group-wrap clearfix">
                                    <a id="login" onclick="login()" type="a" class="new-btn-color"
                                       translate="login_button">登录AT账号</a>
                                </div>
                                <div class="reg-right-info clearfix">
                                    <p translate="reg_right_info1" class="col-xs-12 col-sm-6 fl">还没有账号？</p>
                                    <a href="register.html" class="fr reg-ui-login" translate="nav7">注册</a>
                                </div>
                            </div>
                            <div class="login-group-setp login-group-setp-code" style="display:none;">
                                <div class="webcome-at">
                                    <span class="titl" translate="mobile_verify_placeholder">输入验证码</span>
                                    <p><em class="translate_em" translate="yanzhengmayifasongzhi"></em><em
                                            id="sendId"></em></p>
                                </div>

                                <div class="clearfix login_codes">
                                    <div class="login-group-wrap">
                                        <span class="titl" translate="mobile_verify">验证码</span>
                                        <div class="input_wrap">
                                            <input id="moble_verify" type="text" class="am-form-field am-radius"
                                                   value="" data-i18n-placeholder="financial_first4_placeholder4"
                                                   onkeyup="this.value=this.value.replace(/\D/g,'')"
                                                   onafterpaste="this.value=this.value.replace(/\D/g,'')">
                                            <button type="button" id="btn_sendCode" class="secodes"
                                                    onclick="getCode(this)" translate="mobile_verify_get">获取验证码
                                            </button>
                                        </div>
                                    </div>
                                    <!--<button id="btn_sendCode" onclick="SendCode()" type="button" class="am-btn am-btn-secondary am-radius am-margin-left-sm am-align-left">获取验证码</button>-->

                                </div>
                                <div class="login-group-wrap clearfix">
                                    <a id="loginCode" onclick="login2()" class="new-btn-color"
                                       translate="make_sure">确定</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- <footer id="footer" class="footer"></footer> -->
    <div class="register-login-footer"></div>

    <div class="am-modal am-modal-no-btn" tabindex="-1" id="modelBox">
        <div class="am-modal-dialog">
            <div class="am-modal-hd" translate="verification">验证
                <a id="at_modlog" href="javascript: void(0)" class="am-close am-close-spin"
                   data-am-modal-close>&times;</a>
            </div>
            <dl class="am-modal-bd" id="sliderBox" style="padding: 10px 20px;">
                <div id="aliSliderBox" class="nc-container"></div>
            </dl>
            <button id="btn_slider" onclick="SendCode()" type="button" class="am-btn am-btn-secondary am-radius"
                    style="float: right;margin-right: 20px" translate="make_sure">确定
            </button>
        </div>
    </div>
</div>
<!--[if lt IE 9]>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="./assets/js/amazeui.ie8polyfill.min.js"></script>
<![endif]-->

<script src="./assets/js/amazeui.min.js"></script>
<script src="./assets/js/count-number.js"></script>
<script type="text/javascript">
    // 已登录跳转
    var LoginInfo = $.getToken();
    if (LoginInfo != "") {
        window.location.href = "./index.html";
    }
    function checkUserName(value, e) {
        var keycode = e.which;          //keycode就是按键的编码,e当前元素element,e.which是当前的编码  
        if (value == "" || keycode == 32) {
            $("#username_test").hide();
            $("#username").removeClass("v_error_new")
            return;
        } else {
            var param = {
                userName: value
            };
            $.ajaxSendData(param, "/api/auth", function (resData) {
                if (resData.code == 200 && resData.data) {
                    $("#username_test").hide();
                    $("#username").removeClass("v_error_new")
                } else {
                    $("#username_test").show();
                    $("#username").addClass("v_error_new")
                }
            });

        }

    }
    $(function () {
        $("#header").load("./main/common/indexHeader.html?version=" + $.version);
        $("#footer").load("./main/common/indexFooter.html?version=" + $.version);
    });
    var phoneRegx = /^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/;
    var emailRegx = /^([a-z0-9A-Z]+[-|\.]?)+[a-z0-9A-Z]@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\.)+[a-zA-Z]{2,}$/;

    function setTipsAdd(str) {
        $("#" + str).addClass("v_error_new");
        $("#" + str + "_test.pwd_tips").show();
    }

    function setTipsRemove(str) {
        $("#" + str).removeClass("v_error_new");
        $("#" + str + "_test.pwd_tips").hide();
    }

    function checkPhone(value) {
        if (value === "") {
            setTipsRemove("username");
            return false;
        }

        if (!phoneRegx.test(value) && value.indexOf("@") == -1) {
            setTipsAdd("username");
            return false;
        } else {
            setTipsRemove("username");
        }

        if (!emailRegx.test(value) && value.indexOf("@") != -1) {
            setTipsAdd("username");
            return false;
        } else {
            setTipsRemove("username");
        }

        // console.log(typeof $.usernameType(username) == "undefined");
    }

    function checkPassword(value) {
        if (value === "") {
            setTipsAdd("password");
            return false;
        } else {
            setTipsRemove("password");
        }

        // console.log(typeof $.usernameType(username) == "undefined");
    }
    enterLogin();
    function enterLogin(){
        $(document).keyup(function(event){ 
            if(event.keyCode ==13){
                if(event.target.id == "username" || event.target.id == "password"){
                    login()
                }else if(event.target.id == "moble_verify"){
                    login2()
                }
            }
        });
    }
    function login() {
        var username = $("#username").val();
        var password = $("#password").val();
        if (username === "") {
            $("#username").addClass("v_error_new");
            $("#username_test.pwd_tips").show();
        }
        if (password === "") {
            $("#password").addClass("v_error_new");
            $("#password_test.pwd_tips").show();
        }
        if (password === "") {
            layer.msg(langPkg.getI18N("login_error_null"), {icon: 2, time: 2000});
            return false;
        }

        if (username === "") {
            layer.msg(langPkg.getI18N("error_msg1"), {icon: 2, time: 2000});
            return false;
        }

        if (password === "") {
            layer.msg(langPkg.getI18N("login_error_null"), {icon: 2, time: 2000});
            return false;
        }


        //  将数据拼接成字符串
        var str = {userName: username, password: password};
        $.ajaxSendData(str, "/api/auth", function (resData) {
            getCode($("#btn_sendCode"))
        })
    }

    function login2() {
        var username = $("#username").val();
        var password = $("#password").val();
        var code = $("#moble_verify").val();
        if (isSlider === false) {
            $.ajaxSendData("", "/api/aliVerificaCode", function (resData) {
                isSlider = resData.data;
                if (isSlider === false) {
                    layer.msg(langPkg.getI18N("tuodonghuadongyanzheng"), {icon: 2, time: 1500}, function () {
                        $("#login").removeAttr("disabled");
                    });
                    return false;
                }
            });

        } else {
            //  将数据拼接成字符串
            var goBeforeUrl = "";
            var url = "";
            if(window.location.href.indexOf("/main") != -1){
                url = window.location.href.split("/main")[0];
            }
            var param = {userName: username, password: password, code: code};
            $.ajaxSendData(param, "/api/login", function (resData) {
                var datas = resData.data;
                var token = datas.token;
                var key = datas.randomKey;
                $.loginSet(token, key);
                var cookies = $.getToken();
                if(window.sessionStorage && sessionStorage.beforeUrl != "" && typeof sessionStorage.beforeUrl != "undefined"){
                    if(goBeforeUrl == "/forgetLoginPwd.html" || goBeforeUrl == "/register.html"){
                        goHome();
                    }else{
                        goBeforeUrl = url + "/main" + sessionStorage.beforeUrl;
                        window.location.href = goBeforeUrl;
                    }
                }else{
                    goHome();
                }
            }, function(resData){
                layer.msg(resData.msg, {icon: 2, time: 1500}, function () {
                    $("#login").removeAttr("disabled");
                });
                return false;
            });

        }
    }

    //  获取验证码，只是为了弹出框
    function getCode(_this) {
        var username = $("#username").val();
        if (username === "") {
            layer.msg(langPkg.getI18N("error_msg1"), {icon: 2, time: 2000});
            return false;
        }
        //打开阿里验证
        OpenAliValidate(_this, username, 1, $('#btn_sendCode'), function (username) {
            $(".login-group-setp-code").show();
            $(".login-group-setp-username").hide();
            $("#sendId").html($.usernameType(username))
        });
    }

    function goHome(){
        window.location.href = "./index.html";
    }
</script>

</body>
</html>
